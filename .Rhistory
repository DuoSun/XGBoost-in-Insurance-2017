theme_bw()
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Pure Premium Gini Plot")+
theme(plot.title = element_text(hjust = 0.5))+
theme_bw()
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Purple")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Purple")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-giniPlot + scale_colour_manual("",
breaks = c("Unipol", "MachineLearning"),
values = c("#9D2C20","#01244E"))
giniPlot
setwd("C:/Users/E3850004/Desktop/git/R-in-Insurance-2017")
ggsave(filename = "gini_cas.png",plot=giniPlot)
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="CAS Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot<-giniPlot + scale_colour_manual("",
breaks = c("Unipol", "MachineLearning"),
values = c("#9D2C20","#01244E"))
ggsave(filename = "gini_cas.png",plot=giniPlot)
giniPlot
ix_t = grep("cost_xgbt", colnames(nonocas_df))
ix_x = setdiff( grep("cost_xgb", colnames(nonocas_df)), ix_t)
ix_g = grep("cost_gam", colnames(nonocas_df))
perf_t<-with(nocas_df, ScoreFunc(PIx = rep(1,dim(nocas_df)[1]),Sx = rowMeans(nocas_df[,ix_t]), mx = true_amount))
perf_x<-with(nocas_df,ScoreFunc(PIx = rep(1,dim(nocas_df)[1]),Sx = rowMeans(nocas_df[,ix_x]), mx = true_amount))
perf_g<-with(nocas_df,ScoreFunc(PIx = rep(1,dim(nocas_df)[1]),Sx = rowMeans(nocas_df[,ix_g]), mx = true_amount))
posizioni<-findInterval(seq(0,1,.05), perf_t$Retmat$DFPrem)
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot<-giniPlot + scale_colour_manual("",
breaks = c("Unipol", "MachineLearning"),
values = c("#9D2C20","#01244E"))
giniPlot
normalizedGini(aa = rowMeans(nocas_df[,ix_t]) , pp =nocas_df[[true_amount]])
normalizedGini(aa = rowMeans(nocas_df[,ix_t]) , pp =nocas_df$true_amount)
normalizedGini(aa = nocas_df$true_amount , pp = rowMeans(nocas_df[,ix_t]))
normalizedGini(aa = nocas_df$true_amount , pp = rowMeans(nocas_df[,ix_x]))
normalizedGini(aa = nocas_df$true_amount , pp = rowMeans(nocas_df[,ix_g]))
normalizedGini(aa = cas_df$true_amount , pp = rowMeans(cas_df[,ix_t])) #0.3891004
normalizedGini(aa = cas_df$true_amount , pp = rowMeans(cas_df[,ix_x])) # 0.3371711
normalizedGini(aa = cas_df$true_amount , pp = rowMeans(cas_df[,ix_g])) #0.325567
giniPlot<-giniPlot + scale_colour_manual("",
breaks = c("ss", "Unipol", "MachineLearning"),
values = c("Blue","Red", "Green"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_colour_manual("",
breaks = c("ss", "Unipol", "MachineLearning"),
values = c("Blue","Red", "Green"))+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_colour_manual("",
breaks = c("ss", "Unipol", "MachineLearning"),
values = c("Blue","Red", "Green"))+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_colour_manual("",
breaks = c("ss", "Unipol", "MachineLearning"),
values = c("Blue","Red", "Green"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_colour_manual("",
breaks = c("ss", "Unipol", "MachineLearning"),
values = c("Blue","Red", "Green"))
giniPlot
giniPlot<-giniPlot + scale_colour_manual(values=c("setosa"="Reg", "versicolor"="Green",
"virginica"="Blue"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot<-giniPlot + scale_colour_manual(values=c("setosa"="Reg", "versicolor"="Green",
"virginica"="Blue"))
giniPlot
giniPlot<-giniPlot + scale_colour_manual(values=c("setosa"="Red", "versicolor"="Green",
"virginica"="Blue"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot<-giniPlot + scale_colour_manual(values=c("setosa"="Red", "versicolor"="Green",
"virginica"="Blue"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(legend.position = c(.75, .25))+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
# theme_bw()+
theme(legend.position = c(.75, .25))+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-giniPlot + scale_colour_manual(values=c("setosa"="Red", "versicolor"="Green",
"virginica"="Blue"))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
theme(legend.position = c(.75, .25))+
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
# theme_bw()+
# theme(legend.position = c(.75, .25))+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
perf_g$Retmat$DFPrem[posizioni]
perf_g$Retmat$DFLoss[posizioni]
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")
giniPlot
c(0,perf_g$Retmat$DFPrem[posizioni])
DFPrem
giniPlot<-ggplot(data=perf_t$Retmat[posizioni,]) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")
giniPlot
perf_t$Retmat[posizioni,]
posizioni
posizioni
perf_t$Retmat
posizioni<-findInterval(seq(0,1,.05), perf_t$Retmat$DFPrem)
posizioni
perf_t$Retmat[posizioni,]
posizioni
perf_t$Retmat[0,]
perf_t$Retmat[1,]
perf_t$Retmat[4999,]
perf_t$Retmat[posizioni,]
temp = data.frame(DFPrem=0)
temp
temp = data.frame(DFPrem=0, DFLoss=0, Bound=0)
rbind(temp,perf_t$Retmat[posizioni,])
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")
giniPlot
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=c(0,DFPrem, y=DFLoss)), color="Blue") +
geom_line(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), color="Red") +
geom_line(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), color="Green")
giniPlot
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=c(0,DFPrem, y=DFLoss)), color="Blue") +
geom_line(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni])
giniPlot
c(0,DFPrem, y=DFLoss))
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=c(0,DFPrem, y=DFLoss), color="Blue")
giniPlot
perf_x$Retmat$DFLoss[posizioni])
perf_x$Retmat$DFLoss[posizioni]
length(perf_x$Retmat$DFLoss[posizioni])
perf_t$Retmat[posizioni,]
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")
giniPlot
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue")
giniPlot
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=perf_x$Retmat$DFPrem[posizioni],
y=perf_x$Retmat$DFLoss[posizioni]), color="Red") +
geom_line(aes(x=perf_g$Retmat$DFPrem[posizioni],
y=perf_g$Retmat$DFLoss[posizioni]), color="Green")
giniPlot
DFPrem
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), color="Red")
giniPlot
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), color="Red") +
geom_line(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="Private Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
ggsave(filename = "gini_nocas.png",plot=giniPlot)
ix_t = grep("cost_xgbt", colnames(nocas_df))
ix_x = setdiff( grep("cost_xgb", colnames(nocas_df)), ix_t)
ix_g = grep("cost_gam", colnames(nocas_df))
perf_t<-with(cas_df, ScoreFunc(PIx = rep(1,dim(cas_df)[1]),Sx = rowMeans(cas_df[,ix_t]), mx = true_amount))
perf_x<-with(cas_df,ScoreFunc(PIx = rep(1,dim(cas_df)[1]),Sx = rowMeans(cas_df[,ix_x]), mx = true_amount))
perf_g<-with(cas_df,ScoreFunc(PIx = rep(1,dim(cas_df)[1]),Sx = rowMeans(cas_df[,ix_g]), mx = true_amount))
posizioni<-findInterval(seq(0,1,.05), perf_t$Retmat$DFPrem)
temp = data.frame(DFPrem=0, DFLoss=0, Bound=0)
giniPlot<-ggplot(data=rbind(temp,perf_t$Retmat[posizioni,])) +
geom_point(aes(x=DFPrem, y=DFLoss), col="Blue") +
geom_point(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), shape=3, color="Red")+
geom_point(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), shape=4, color="Green")+
geom_line(aes(x=DFPrem, y=DFLoss), color="Blue") +
geom_line(aes(x=c(0,perf_x$Retmat$DFPrem[posizioni]),
y=c(0,perf_x$Retmat$DFLoss[posizioni])), color="Red") +
geom_line(aes(x=c(0,perf_g$Retmat$DFPrem[posizioni]),
y=c(0,perf_g$Retmat$DFLoss[posizioni])), color="Green")+
scale_x_continuous(name="Cumulative share of Insured", limits=c(0,1)) +
scale_y_continuous(name="Cumulative share of Loss", limits=c(0,1)) +
geom_abline() +labs(title="CAS Data: Pure Premium Gini Plot")+
theme_bw()+
theme(plot.title = element_text(hjust = 0.5))
giniPlot
ggsave(filename = "gini_cas.png",plot=giniPlot)
?bam
pred_numeric_spline
xvarCat
pred_numeric_spline <- paste(as.character(sapply(X = xvarCont,stringaSpline)),collapse = "+")
pred_factor_formula <- paste(as.character(xvarCat),collapse = "+")
bam_formula_rhs <- paste(pred_numeric_spline,pred_factor_formula,sep =  "+")
bam_formula_NB <- paste(yvarNB,"~",bam_formula_rhs,"+offset(",offset,")",sep="")
yvarNB = "y"
bam_formula_rhs <- paste(pred_numeric_spline,pred_factor_formula,sep =  "+")
bam_formula_NB <- paste(yvarNB,"~",bam_formula_rhs,"+offset(",offset,")",sep="")
bam_formula_NB
yvarNB
bam_formula_rhs
train = read.csv("C:\\Users\\E3850004\\Desktop\\home\\sberbank", sep=",")
train = read.csv("C:\\Users\\E3850004\\Desktop\\home\\sberbank")
train = read.csv("C:\\Users\\E3850004\\Desktop\\home\\sberbank\\train_fixed.csv")
head(train)
str(train)
